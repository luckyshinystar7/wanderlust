name: "PR Title Checker"
on:
  pull_request:
    types:
      - opened
      - synchronize
      - reopened
      - edited
      - closed

permissions:
  contents: write
  pull-requests: write

jobs:
  check:
    runs-on: ubuntu-latest

    steps:
      - name: Check out code
        uses: actions/checkout@v2

      - name: Run PR Title Checker
        id: title-check
        uses: thehanimo/pr-title-checker@v1.4.1
        with:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          pass_on_octokit_error: false
          configuration_path: .github/pr-title-checker-config.json
      - name: pr title satisfied
        if: sucess()
        run: |
          gh issue comment ${{ github.event.pull_request.number }} -R ${{ github.repository }} --body "Thank you! Your PR title meets our guidelines."

      - name: Close PR if title is invalid
        if: failure()
        run: |
          gh pr close ${{ github.event.pull_request.number }} -R ${{ github.repository }}
          gh issue comment ${{ github.event.pull_request.number }} -R ${{ github.repository }} --body |
            "Thank you for your PR. Unfortunately, it doesn't meet our quality checks.\n\nPlease ensure you follow our contribution guidelines. The PR title should match the required format.\n\nFor example, it should be like: fix-#124: Added responsiveness to the Home page screen.\n\nOnce you've updated the title to follow the regex format, we can proceed with your PR. Thank you for understanding!"

        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Reopen PR if title is corrected
        if: github.event.action == 'edited' && success()
        run: |
          if [ "${{ github.event.pull_request.state }}" == "closed" ]; then
            gh pr reopen ${{ github.event.pull_request.number }} -R ${{ github.repository }}
          fi
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
